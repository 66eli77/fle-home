{% extends base_template %}
{% load staticfiles %}

{% block extrahead %}
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCUVMGp6Uks8OCczFfrWo20zHnmENyW5O0&v=3.9&sensor=false&libraries=places">
    </script>
    <script>
        function showDeployments() {
            // Create map 
            $("#map_canvas").height($(window).height());
            var map = new google.maps.Map(document.getElementById('map_canvas'), {
                mapTypeId: google.maps.MapTypeId.HYBRID,
                // scrollwheel: false,
                maxZoom: 20,
                minZoom: 2,
                zoomControl: true,
                panControl: true,
                streetViewControl: false
            });

            var defaultBounds = new google.maps.LatLngBounds(
                                new google.maps.LatLng(70, -100),
                                new google.maps.LatLng(-60, 100));
                                map.fitBounds(defaultBounds);

            // Add markers 
            var deployments = $.parseJSON("{{deployments_json}}".replace(/&quot;/g, '"'));
            for (var i = 0; i < deployments.length; i++) {
                var title = deployments[i].fields.title;
                var slug = deployments[i].fields.slug;
                var latitude = deployments[i].fields.latitude;
                var longitude = deployments[i].fields.longitude;
                var latLng = new google.maps.LatLng(latitude, longitude);
                
                var marker = new google.maps.Marker({
                    position: latLng,
                    map: map,
                    title: title,
                    slug: slug
                });
                google.maps.event.addListener(marker, 'click', function() {
                    $('#' + this.slug).modal();
                });

            }
        }
        
        google.maps.event.addDomListener(window, 'load', showDeployments);
    </script>
{% endblock extrahead %}

{% block title %}
    Deployments Map
{% endblock title %}

{% block bodycontents %}
    <div class="container">
        <div class="row">
            <div class="col-xs-12">
                <div id="map_canvas"></div>            
            </div>
        </div>
    </div>

    {# Modals for each pin #}
    {% for d in deployments %}
    <div class="modal fade" id="{{ d.slug }}" tabindex="-1" role="dialog" aria-labelledby="{{ d.title }}" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            <h4 class="modal-title" id="myModalLabel">{{ d.title }}</h4>
          </div>
          <div class="modal-body">
            {{ d.description }}
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary">Request to connect</button>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
{% endblock bodycontents %}
    

