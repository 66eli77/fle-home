from itertools import groupby
from annoying.decorators import render_to
from fack.models import Question, Topic

from django.shortcuts import get_object_or_404

from .models import UserResource

@render_to("ka_lite/faq.html")
def faq(request):
	"""Render FAQ generated by django-fack backend (override django-fack styles)"""
	topics = Topic.objects.all()
	context = {}
	for t in topics: 
		context[t] = Question.objects.filter(topic=t).active()

	return {"faq": context}

@render_to("ka_lite/user-resources.html")
def user_resources(request):
	"""Render list of user resources"""
	resources = UserResource.objects.all()
	context = []
	# Group by versions
	for version, group in groupby(resources, lambda x: x.version):
		grouped_items = [g for g in group]
		context.append({
			version: grouped_items,
		})

	return {"resources": context}

@render_to("ka_lite/user-resource-detail.html")
def user_resource_detail(request, slug):
	"""Render detail of user resource"""
	obj = get_object_or_404(UserResource.objects.filter(slug=slug))
	return {"resource": obj}